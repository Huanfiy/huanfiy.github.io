<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实用工具 - Haunfly</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
</head>
<body>

    <header>
        <div class="container">
            <a href="index.html" class="logo">
                <img src="picture/icon.png" alt="Logo">
                <span>Haunfly</span>
            </a>
            <div class="menu-toggle"><i class="fas fa-bars"></i></div>
            <nav class="nav-links">
                <a href="index.html">主页</a>
                <a href="blog.html">博客</a>
                <a href="tool.html" class="active">工具</a>
                <a href="about.html">关于</a>
            </nav>
        </div>
    </header>

    <main class="container" style="padding-top: 2rem;">
        
        <!-- 工具列表视图 -->
        <div id="tools-grid-view">
            <h2 class="section-title" data-aos="fade-up">实验室</h2>
            <p style="text-align: center; color: var(--light-text); margin-bottom: 3rem;" data-aos="fade-up">
                一些为提高效率而开发的小工具，全部在浏览器本地运行。
            </p>

            <div class="grid-3">
                <!-- 1. 图片转 ICO (页内运行) -->
                <div class="card tool-card" data-aos="fade-up" onclick="openIcoTool()" style="cursor: pointer;">
                    <div class="tool-icon"><i class="fas fa-image"></i></div>
                    <h3>图片转 ICO</h3>
                    <p style="color: var(--light-text); font-size: 0.9rem; margin: 10px 0;">快速将 PNG/JPG 图片转换为网站图标文件。</p>
                    <button class="btn btn-outline" style="margin-top: auto;">立即使用</button>
                </div>

                <!-- 2. ESP32 Pinmapper (外部链接) -->
                <div class="card tool-card" data-aos="fade-up" data-aos-delay="100" onclick="location.href='esp32_pinmapper.html'" style="cursor: pointer;">
                    <div class="tool-icon" style="color: #e67e22; background: #fdf0e7;"><i class="fas fa-microchip"></i></div>
                    <h3>ESP32 引脚映射</h3>
                    <p style="color: var(--light-text); font-size: 0.9rem; margin: 10px 0;">ESP32 开发板引脚功能查询与规划工具。</p>
                    <button class="btn btn-outline" style="margin-top: auto;">打开工具</button>
                </div>

                <!-- 3. 打字练习 (外部链接) -->
                <div class="card tool-card" data-aos="fade-up" data-aos-delay="200" onclick="location.href='keyboard.html'" style="cursor: pointer;">
                    <div class="tool-icon" style="color: #9b59b6; background: #f5eef8;"><i class="fas fa-keyboard"></i></div>
                    <h3>打字练习</h3>
                    <p style="color: var(--light-text); font-size: 0.9rem; margin: 10px 0;">提高键盘敲击速度，支持多种模式。</p>
                    <button class="btn btn-outline" style="margin-top: auto;">开始练习</button>
                </div>

                 <!-- 4. 淘宝链接转换 (外部链接) -->
                 <div class="card tool-card" data-aos="fade-up" data-aos-delay="300" onclick="location.href='buy.html'" style="cursor: pointer;">
                    <div class="tool-icon" style="color: #ff6b6b; background: #fff0f0;"><i class="fas fa-shopping-cart"></i></div>
                    <h3>链接转换器</h3>
                    <p style="color: var(--light-text); font-size: 0.9rem; margin: 10px 0;">淘宝/京东链接快速清理与转换。</p>
                    <button class="btn btn-outline" style="margin-top: auto;">打开工具</button>
                </div>
            </div>
        </div>

        <!-- ICO 工具运行界面 (默认隐藏) -->
        <div id="ico-tool-view" style="display: none; max-width: 800px; margin: 0 auto;">
            <button onclick="closeIcoTool()" class="btn btn-outline" style="margin-bottom: 2rem;">
                <i class="fas fa-arrow-left"></i> 返回工具库
            </button>
            
            <div class="card">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div class="tool-icon" style="margin: 0 auto 1rem;"><i class="fas fa-image"></i></div>
                    <h2>图片转 ICO</h2>
                    <p style="color: var(--light-text);">建议上传正方形图片 (PNG/JPG)</p>
                </div>

                <div style="border: 2px dashed var(--border-color); border-radius: var(--radius-md); padding: 3rem; text-align: center; cursor: pointer; transition: all 0.3s;" id="drop-zone">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                    <p>点击选择或拖拽图片至此</p>
                    <input type="file" id="imageInput" accept="image/png, image/jpeg, image/jpg" style="display: none;">
                </div>

                <!-- 预览区 -->
                <div id="preview-area" style="display: none; margin-top: 2rem; text-align: center;">
                    <p>预览 (64x64):</p>
                    <img id="imagePreview" style="width: 64px; height: 64px; border: 1px solid #ddd; margin: 10px auto; object-fit: contain;">
                    
                    <div style="margin-top: 1.5rem; display: flex; justify-content: center; gap: 1rem;">
                        <button id="convertButton" class="btn">生成并下载 ICO</button>
                        <button onclick="resetIcoTool()" class="btn btn-outline">重置</button>
                    </div>
                </div>
                
                <canvas id="canvas" width="64" height="64" style="display: none;"></canvas>
                <a id="downloadLink" style="display: none;"></a>
            </div>
        </div>

    </main>

    <footer>
        <div class="container">
            <p style="color: var(--light-text); font-size: 0.9rem;">&copy; 2024 Haunfly. Keep Building.</p>
        </div>
    </footer>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="js/script.js"></script>
    <script>
        AOS.init({ duration: 800, once: true });

        // --- ICO Tool Logic ---
        const toolsGrid = document.getElementById('tools-grid-view');
        const icoView = document.getElementById('ico-tool-view');
        const dropZone = document.getElementById('drop-zone');
        const imageInput = document.getElementById('imageInput');
        const previewArea = document.getElementById('preview-area');
        const imagePreview = document.getElementById('imagePreview');

        function openIcoTool() {
            toolsGrid.style.display = 'none';
            icoView.style.display = 'block';
            window.scrollTo(0, 0);
        }

        function closeIcoTool() {
            icoView.style.display = 'none';
            toolsGrid.style.display = 'block';
            resetIcoTool();
            setTimeout(() => AOS.refresh(), 100);
        }

        function resetIcoTool() {
            imageInput.value = '';
            previewArea.style.display = 'none';
        }

        // Upload Handlers
        dropZone.addEventListener('click', () => imageInput.click());
        
        imageInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    previewArea.style.display = 'block';
                };
                reader.readAsDataURL(this.files[0]);
            }
        });

        // Convert Logic
        document.getElementById("convertButton").addEventListener("click", function () {
            const canvas = document.getElementById("canvas");
            const ctx = canvas.getContext("2d");
            if (!imageInput.files.length) return;

            const img = new Image();
            img.src = imagePreview.src;
            img.onload = function () {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                
                canvas.toBlob(function (blob) {
                    const url = URL.createObjectURL(blob);
                    const link = document.getElementById("downloadLink");
                    link.href = url;
                    link.download = "icon.ico";
                    link.click();
                    URL.revokeObjectURL(url);
                }, "image/x-icon");
            };
        });
    </script>
</body>
</html>
