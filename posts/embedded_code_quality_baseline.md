---
title: 嵌入式代码质量基线：可维护、可移植、可验证
date: 2026-02-13
tag: 工程实践
summary: 从编码风格到错误处理，建立一条工程可落地的嵌入式代码质量基线。
cover: picture/icon-practice.png
---

# 嵌入式代码质量基线

嵌入式项目里，“能跑”只是起点。  
真正决定项目寿命的，是代码是否长期可维护、可移植、可验证。

## 1. 风格统一优先于个人偏好

- 统一命名：变量/函数/宏保持一致规则
- 统一格式：固定 `clang-format` 配置
- 控制复杂度：一眼看不懂的函数，就要拆分

个人习惯可以不同，但团队输出必须统一。

## 2. 错误处理必须“显式”

- 系统调用和硬件访问都检查返回值
- 错误码统一定义，不要到处散落魔法数字
- 关键路径优先 fail-safe，而不是侥幸继续执行

不处理错误，就是把问题延后到更难排查的阶段。

## 3. 资源与内存策略

- 优先静态分配，谨慎动态分配
- 资源有申请就要有释放
- 谨慎递归，避免栈风险
- 中断中避免做重操作

嵌入式的限制条件决定了这部分不能“随便写”。

## 4. 中断与并发约束

- ISR 只做最小必要动作
- 耗时处理放到任务上下文
- 共享资源必须加锁并评估死锁风险
- 中断共享变量正确使用 `volatile`

实时系统里，时序正确和功能正确同等重要。

## 5. 可移植性与抽象层

- 避免硬编码寄存器地址
- 通过 HAL/驱动接口隔离平台差异
- 关键配置集中管理，避免散落常量

可移植性不是为了“以后可能换平台”，而是为了现在就能更稳地演进。

## 6. 工具链纳入日常流程

- `clang-format`：风格统一
- `clang-tidy` / 静态分析：提前发现风险
- 文档化接口：降低协作成本
- Git 提交规范：便于回溯

工具不是替代思考，而是减少低价值重复劳动。

## 结语

代码质量不是“额外工作”，而是交付能力的一部分。  
把质量基线前置，后期调试和维护成本会明显下降。
